name: godot-tests

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Download Godot headless/server build
      - name: Download Godot
        run: |
          GODOT_VERSION=4.3
          wget https://downloads.tuxfamily.org/godotengine/$GODOT_VERSION/Godot_v${GODOT_VERSION}-stable_linux.x86_64.zip -O godot.zip
          unzip godot.zip
          mv Godot_v${GODOT_VERSION}-stable_linux.x86_64 godot
          chmod +x godot

      # Run the project headless and capture output
      - name: Run Godot project
        id: run_godot
        run: |
          set -e
          # run the game once; --headless to avoid GUI
          # change --path . to your project folder if needed
          ./godot --headless --path . > godot.log 2>&1 || true
          cat godot.log
          if grep -q "TestChessGame: PASS" godot.log; then
            echo "Godot test passed."
          else
            echo "Godot test failed: 'TestChessGame: PASS' not found."
            exit 1
          fi

      # optional: upload log so you can inspect in PR
      - name: Upload log
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: godot-log
          path: godot.log
